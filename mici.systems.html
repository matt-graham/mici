<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mici.systems module &mdash; Mici 0.2.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mici.transitions module" href="mici.transitions.html" />
    <link rel="prev" title="mici.states module" href="mici.states.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/mici-logo-rectangular.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="mici.html">mici package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="mici.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mici.adapters.html">mici.adapters module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.autodiff.html">mici.autodiff module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.autograd_wrapper.html">mici.autograd_wrapper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.errors.html">mici.errors module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.integrators.html">mici.integrators module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.interop.html">mici.interop module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.matrices.html">mici.matrices module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.progressbars.html">mici.progressbars module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.samplers.html">mici.samplers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.solvers.html">mici.solvers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.stagers.html">mici.stagers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.states.html">mici.states module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">mici.systems module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem"><code class="docutils literal notranslate"><span class="pre">CholeskyFactoredRiemannianMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.ConstrainedEuclideanMetricSystem"><code class="docutils literal notranslate"><span class="pre">ConstrainedEuclideanMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.DenseConstrainedEuclideanMetricSystem"><code class="docutils literal notranslate"><span class="pre">DenseConstrainedEuclideanMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.DenseRiemannianMetricSystem"><code class="docutils literal notranslate"><span class="pre">DenseRiemannianMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.DiagonalRiemannianMetricSystem"><code class="docutils literal notranslate"><span class="pre">DiagonalRiemannianMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.EuclideanMetricSystem"><code class="docutils literal notranslate"><span class="pre">EuclideanMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem"><code class="docutils literal notranslate"><span class="pre">GaussianDenseConstrainedEuclideanMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.GaussianEuclideanMetricSystem"><code class="docutils literal notranslate"><span class="pre">GaussianEuclideanMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.RiemannianMetricSystem"><code class="docutils literal notranslate"><span class="pre">RiemannianMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.ScalarRiemannianMetricSystem"><code class="docutils literal notranslate"><span class="pre">ScalarRiemannianMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.SoftAbsRiemannianMetricSystem"><code class="docutils literal notranslate"><span class="pre">SoftAbsRiemannianMetricSystem</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mici.systems.System"><code class="docutils literal notranslate"><span class="pre">System</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mici.transitions.html">mici.transitions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.types.html">mici.types module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mici.utils.html">mici.utils module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Mici</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="mici.html">mici package</a></li>
      <li class="breadcrumb-item active">mici.systems module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mici.systems.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-mici.systems">
<span id="mici-systems-module"></span><h1>mici.systems module<a class="headerlink" href="#module-mici.systems" title="Permalink to this heading"></a></h1>
<p>Hamiltonian systems encapsulating energy functions and their derivatives.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">CholeskyFactoredRiemannianMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_chol_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vjp_metric_chol_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#CholeskyFactoredRiemannianMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.RiemannianMetricSystem" title="mici.systems.RiemannianMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">RiemannianMetricSystem</span></code></a></p>
<p>Riemannian-metric system with Cholesky-factored matrix representation.</p>
<p>Hamiltonian system with a position dependent metric matrix representation which is
specified by its Cholesky factor by a matrix function <cite>metric_chol_func</cite> of the
position <cite>q</cite> which outputs a lower-triangular matrix <cite>L = metric_chol_func(q)</cite> with
the metric matrix representation then taken to be <cite>L &#64; L.T</cite>.</p>
<p>See documentation of <cite>RiemannianMetricSystem</cite> for more general details about
Riemannian-metric Hamiltonian systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>metric_chol_func</strong> (<em>ArrayFunction</em>) – Function which given a position array returns a 2D array
with zeros above the diagonal corresponding to the lower-triangular
Cholesky-factor of the positive definite metric matrix representation.</p></li>
<li><p><strong>vjp_metric_chol_func</strong> (<em>Optional</em><em>[</em><em>VectorJacobianProductFunction</em><em>]</em>) – <p>Function which given a position array returns another
function which takes a lower-triangular 2D array as an argument (any
values in the array above the diagonal are ignored) and returns the
<em>vector-Jacobian-product</em> (VJP) of <cite>metric_chol_func</cite> with respect to
the position array argument. The VJP is here defined as a function of a
2D array <cite>v</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the <cite>(dim_pos, dim_pos, dim_pos)</cite> shaped Jacobian of <cite>L
= metric_chol_func(q)</cite> with respect to <cite>q</cite> i.e. the array of partial
derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[i, j, k] = ∂L[i, j] / ∂q[k]
</pre></div>
</div>
<p>Optionally the function may instead return a 2-tuple of values with the
first a function to compute a VJP of <cite>metric_chol_func</cite> and the second a
2D array containing the value of <cite>metric_chol_func</cite>, both evaluated at
the passed position array. If <cite>None</cite> is passed (the default) an
automatic differentiation fallback will be used to attempt to construct
a function which calculates the VJP (and value) of <cite>metric_chol_func</cite>
automatically.</p>
</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.metric" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the metric matrix representation.</p>
<p>The returned type of this function is that specified by the
<cite>metric_matrix_class</cite> argument to the initializer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Metric matrix representation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.metric_func">
<span class="sig-name descname"><span class="pre">metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the parameter of the metric matrix representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>metric_func(state.pos)</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.CholeskyFactoredRiemannianMetricSystem.vjp_metric_func">
<span class="sig-name descname"><span class="pre">vjp_metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.CholeskyFactoredRiemannianMetricSystem.vjp_metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function constructing a vector-Jacobian-product for <cite>metric_func</cite>.</p>
<p>The vector-Jacobian-product is here defined as a function of an array <cite>v</cite> (of
the same shape as the output of <cite>metric_func</cite>) corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the Jacobian of <cite>m = metric_func(q)</cite> wrt <cite>q</cite> i.e. the array of
partial derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[..., i] = ∂m[...] / ∂q[i]
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute VJP at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vector-Jacobian-product function.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>VectorJacobianProduct</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">ConstrainedEuclideanMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dens_wrt_hausdorff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jacob_constr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.EuclideanMetricSystem" title="mici.systems.EuclideanMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">EuclideanMetricSystem</span></code></a></p>
<p>Base class for Euclidean Hamiltonian systems subject to constraints.</p>
<p>The (constrained) position space is assumed to be a differentiable manifold embedded
with a <span class="math notranslate nohighlight">\(Q\)</span>-dimensional ambient Euclidean space. The <span class="math notranslate nohighlight">\(Q-C\)</span> dimensional
manifold <span class="math notranslate nohighlight">\(\mathcal{M}\)</span> is implicitly defined by an equation
<span class="math notranslate nohighlight">\(\mathcal{M} = \lbrace q \in \mathbb{R}^Q : c(q) = 0 \rbrace\)</span> with
<span class="math notranslate nohighlight">\(c: \mathbb{R}^Q \to \mathbb{R}^C\)</span> the <em>constraint function</em>.</p>
<p>The ambient Euclidean space is assumed to be equipped with a metric with constant
positive-definite matrix representation <span class="math notranslate nohighlight">\(M\)</span> which further specifies the
covariance of the zero-mean Gaussian distribution <span class="math notranslate nohighlight">\(\mathcal{N}(0, M)\)</span> on the
<em>unconstrained</em> momentum (co-)vector <span class="math notranslate nohighlight">\(p\)</span> with corresponding <span class="math notranslate nohighlight">\(h_2\)</span>
Hamiltonian component defined as</p>
<div class="math notranslate nohighlight">
\[h_2(q, p) = \frac{1}{2} p^T M^{-1} p.\]</div>
<p>The time-derivative of the constraint equation implies a further set of constraints
on the momentum <span class="math notranslate nohighlight">\(q\)</span> with :math:` partial c(q) M^{-1} p = 0` at all time
points, corresponding to the momentum (velocity) being in the co-tangent space
(tangent space) to the manifold.</p>
<p>The target distribution is either assumed to be directly specified with unnormalized
density <span class="math notranslate nohighlight">\(\exp(-\ell(q))\)</span> with respect to the Hausdorff measure on the manifold
(under the metric induced from the ambient metric) with in this case the <span class="math notranslate nohighlight">\(h_1\)</span>
Hamiltonian component then simply</p>
<div class="math notranslate nohighlight">
\[h_1(q) = \ell(q),\]</div>
<p>or alternatively it is assumed a prior distribution on the position <span class="math notranslate nohighlight">\(q\)</span> with
density <span class="math notranslate nohighlight">\(\exp(-\ell(q))\)</span> with respect to the Lebesgue measure on the ambient
space is specifed and the target distribution is the posterior distribution on
<span class="math notranslate nohighlight">\(q\)</span> when conditioning on the event <span class="math notranslate nohighlight">\(c(q) = 0\)</span>. The negative logarithm of
the posterior distribution density with respect to the Hausdorff measure (and so
<span class="math notranslate nohighlight">\(h_1\)</span> Hamiltonian component) is then</p>
<div class="math notranslate nohighlight">
\[h_1(q) =
\ell(q) + \frac{1}{2} \log\left|\partial c(q)M^{-1}\partial c(q)^T\right|\]</div>
<p>with an additional second <em>Gram matrix</em> determinant term to give the correct density
with respect to the Hausdorff measure on the manifold.</p>
<p>Due to the requirement to enforce the constraints on the position and momentum, a
constraint-preserving numerical integrator needs to be used when simulating the
Hamiltonian dynamic associated with the system, e.g.
<cite>mici.integrators.ConstrainedLeapfrogIntegrator</cite>.</p>
<p class="rubric">References</p>
<ol class="arabic simple">
<li><p>Lelièvre, T., Rousset, M. and Stoltz, G., 2019. Hybrid Monte Carlo methods for
sampling probability measures on submanifolds. Numerische Mathematik, 143(2),
pp.379-421.</p></li>
<li><p>Graham, M.M. and Storkey, A.J., 2017. Asymptotically exact inference in
differentiable generative models. Electronic Journal of Statistics, 11(2),
pp.5105-5164.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – <p>Function which given a position array returns the negative
logarithm of an unnormalized probability density on the constrained
position space with respect to the Hausdorff measure on the constraint
manifold (if <cite>dens_wrt_hausdorff == True</cite>) or alternatively the negative
logarithm of an unnormalized probability density on the unconstrained
(ambient) position space with respect to the Lebesgue measure. In the
former case the target distribution it is wished to draw approximate
samples from is assumed to be directly specified by the density function
on the manifold. In the latter case the density function is instead
taken to specify a prior distribution on the ambient space with the
target distribution then corresponding to the posterior distribution
when conditioning on the (zero Lebesgue measure) event <cite>constr(pos) ==
0</cite>. This target posterior distribution has support on the differentiable
manifold implicitly defined by the constraint equation, with density
with respect to the Hausdorff measure on the manifold corresponding to
the ratio of the prior density (specified by <cite>neg_log_dens</cite>) and the
square-root of the determinant of the Gram matrix defined by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gram</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">@</span> <span class="n">inv</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span> <span class="o">@</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>where <cite>jacob_constr</cite> is the Jacobian of the constraint function <cite>constr</cite>
and <cite>metric</cite> is the matrix representation of the metric on the ambient
space.</p>
</p></li>
<li><p><strong>constr</strong> (<em>ArrayFunction</em>) – Function which given a position rray return as a 1D array the value
of the (vector-valued) constraint function, the zero level-set of which
implicitly defines the manifold the dynamic is simulated on.</p></li>
<li><p><strong>metric</strong> (<em>Optional</em><em>[</em><em>MetricLike</em><em>]</em>) – Matrix object corresponding to matrix representation of metric on
<em>unconstrained</em> position space and covariance of Gaussian marginal
distribution on <em>unconstrained</em> momentum vector. If <cite>None</cite> is passed
(the default), the identity matrix will be used. If a 1D array is passed
then this is assumed to specify a metric with positive diagonal matrix
representation and the array the matrix diagonal. If a 2D array is
passed then this is assumed to specify a metric with a dense positive
definite matrix representation specified by the array. Otherwise if the
value is a <cite>mici.matrices.PositiveDefiniteMatrix</cite> subclass it is assumed
to directly specify the metric matrix representation.</p></li>
<li><p><strong>dens_wrt_hausdorff</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Whether the <cite>neg_log_dens</cite> function specifies the
(negative logarithm) of the density of the target distribution with
respect to the Hausdorff measure on the manifold directly (True) or
alternatively the negative logarithm of a density of a prior
distriubtion on the unconstrained (ambient) position space with respect
to the Lebesgue measure, with the target distribution then corresponding
to the posterior distribution when conditioning on the event <cite>const(pos)
== 0</cite> (False). Note that in the former case the base Hausdorff measure
on the manifold depends on the metric defined on the ambient space, with
the Hausdorff measure being defined with respect to the metric induced
on the manifold from this ambient metric.</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct a function
to compute the derivative (and value) of <cite>neg_log_dens</cite> automatically.</p></li>
<li><p><strong>jacob_constr</strong> (<em>Optional</em><em>[</em><em>JacobianFunction</em><em>]</em>) – <dl class="simple">
<dt>Function which given a position array computes the Jacobian</dt><dd><p>(matrix / 2D array of partial derivatives) of the output of the
constraint function <cite>c = constr(q)</cite> with respect to the position array
argument <cite>q</cite>, returning the computed Jacobian as a 2D array <cite>jacob</cite> with</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    jacob[i, j] = ∂c[i] / ∂q[j]

Optionally the function may instead return a 2-tuple of values with the
first being the array corresponding to the Jacobian and the second being
the value of `constr` evaluated at the passed position array. If `None`
is passed (the default) an automatic differentiation fallback will be
used to attempt to construct a function to compute the Jacobian (and
value) of `constr` automatically.
</pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.constr">
<span class="sig-name descname"><span class="pre">constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.constr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.constr" title="Permalink to this definition"></a></dt>
<dd><p>Constraint function at the current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>constr(state.pos)</cite> as 1D array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.dh1_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.dh2_flow_dmom">
<span class="sig-name descname"><span class="pre">dh2_flow_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.dh2_flow_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivatives of <cite>h2_flow</cite> flow map with respect to input momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval flow simulated for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Matrix representing derivative (Jacobian) of position output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
<dt>dmom_dmom: Matrix representing derivative (Jacobian) of momentum output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dpos_dmom</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">grad_log_det_sqrt_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of (half of) log-determinant of Gram matrix wrt position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>log_det_sqrt_gram(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.gram">
<span class="sig-name descname"><span class="pre">gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.gram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.gram" title="Permalink to this definition"></a></dt>
<dd><p>Gram matrix at current position.</p>
<p>The Gram matrix as a position <cite>q</cite> is defined as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gram</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">@</span> <span class="n">inv</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span> <span class="o">@</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>where <cite>jacob_constr</cite> is the Jacobian of the constraint function <cite>constr</cite> and
<cite>metric</cite> is the matrix representation of the metric on the ambient space.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Gram matrix as matrix object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.h1"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.h2_flow">
<span class="sig-name descname"><span class="pre">h2_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.h2_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h2</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.inv_gram">
<span class="sig-name descname"><span class="pre">inv_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.inv_gram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.inv_gram" title="Permalink to this definition"></a></dt>
<dd><p>Inverse of Gram matrix at current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Inverse of Gram matrix as matrix object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.jacob_constr">
<span class="sig-name descname"><span class="pre">jacob_constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.jacob_constr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.jacob_constr" title="Permalink to this definition"></a></dt>
<dd><p>Jacobian of constraint function at the current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Jacobian of <cite>constr(state.pos)</cite> as 2D array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.jacob_constr_inner_product">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">jacob_constr_inner_product</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jacob_constr_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inner_product_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jacob_constr_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.jacob_constr_inner_product"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.jacob_constr_inner_product" title="Permalink to this definition"></a></dt>
<dd><p>Compute inner product of rows of constraint Jacobian matrices.</p>
<p>Computes <cite>jacob_constr_1 &#64; inner_product_matrix &#64; jacob_constr_2.T</cite> potentially
exploiting any structure / sparsity in <cite>jacob_constr_1</cite>, <cite>jacob_constr_2</cite> and
<cite>inner_product_matrix</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>jacob_constr_1</strong> (<em>MatrixLike</em>) – First constraint Jacobian in product.</p></li>
<li><p><strong>inner_product_matrix</strong> (<a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a>) – Positive-definite matrix defining inner-product
between rows of two constraint Jacobians.</p></li>
<li><p><strong>jacob_constr_2</strong> (<em>Optional</em><em>[</em><em>MatrixLike</em><em>]</em>) – Second constraint Jacobian in product. Defaults to
<cite>jacob_constr_1</cite> if set to <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>MatrixLike</p>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>Object corresponding to computed inner products of the constraint Jacobian
rows.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.log_det_sqrt_gram">
<span class="sig-name descname"><span class="pre">log_det_sqrt_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.log_det_sqrt_gram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.log_det_sqrt_gram" title="Permalink to this definition"></a></dt>
<dd><p>Value of (half of) log-determinant of Gram matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.project_onto_cotangent_space">
<span class="sig-name descname"><span class="pre">project_onto_cotangent_space</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.project_onto_cotangent_space"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.project_onto_cotangent_space" title="Permalink to this definition"></a></dt>
<dd><p>Project a momentum on to the co-tangent space at a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mom</strong> (<em>ArrayLike</em>) – Momentum (co-)vector as 1D array to project on to co-tangent space.</p></li>
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State definining position on the  manifold to project in to the
co-tangent space of.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Projected momentum in the co-tangent space at <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ConstrainedEuclideanMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ConstrainedEuclideanMetricSystem.sample_momentum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ConstrainedEuclideanMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">DenseConstrainedEuclideanMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dens_wrt_hausdorff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jacob_constr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mhp_constr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#DenseConstrainedEuclideanMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.ConstrainedEuclideanMetricSystem" title="mici.systems.ConstrainedEuclideanMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConstrainedEuclideanMetricSystem</span></code></a></p>
<p>Euclidean Hamiltonian system subject to a dense set of constraints.</p>
<p>See <cite>ConstrainedEuclideanMetricSystem</cite> for more details about constrained systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – <dl class="simple">
<dt>Function which given a position array returns the negative</dt><dd><p>logarithm of an unnormalized probability density on the constrained
position space with respect to the Hausdorff measure on the constraint
manifold (if <cite>dens_wrt_hausdorff == True</cite>) or alternatively the negative
logarithm of an unnormalized probability density on the unconstrained
(ambient) position space with respect to the Lebesgue measure. In the
former case the target distribution it is wished to draw approximate
samples from is assumed to be directly specified by the density function
on the manifold. In the latter case the density function is instead
taken to specify a prior distribution on the ambient space with the
target distribution then corresponding to the posterior distribution
when conditioning on the (zero Lebesgue measure) event <cite>constr(pos) ==
0</cite>. This target posterior distribution has support on the differentiable
manifold implicitly defined by the constraint equation, with density
with respect to the Hausdorff measure on the manifold corresponding to
the ratio of the prior density (specified by <cite>neg_log_dens</cite>) and the
square-root of the determinant of the Gram matrix defined by</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    gram(q) = jacob_constr(q) @ inv(metric) @ jacob_constr(q).T

where `jacob_constr` is the Jacobian of the constraint function `constr`
and `metric` is the matrix representation of the metric on the ambient
space.
</pre></div>
</div>
</p></li>
<li><p><strong>constr</strong> (<em>ArrayFunction</em>) – Function which given a position array return as a 1D array the value
of the (vector-valued) constraint function, the zero level-set of which
implicitly defines the manifold the dynamic is simulated on.</p></li>
<li><p><strong>metric</strong> (<em>Optional</em><em>[</em><em>MetricLike</em><em>]</em>) – Matrix object corresponding to matrix representation of metric on
<em>unconstrained</em> position space and covariance of Gaussian marginal
distribution on <em>unconstrained</em> momentum vector. If <cite>None</cite> is passed
(the default), the identity matrix will be used. If a 1D array is passed
then this is assumed to specify a metric with positive diagonal matrix
representation and the array the matrix diagonal. If a 2D array is
passed then this is assumed to specify a metric with a dense positive
definite matrix representation specified by the array. Otherwise if the
value is a <cite>mici.matrices.PositiveDefiniteMatrix</cite> subclass it is assumed
to directly specify the metric matrix representation.</p></li>
<li><p><strong>dens_wrt_hausdorff</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Whether the <cite>neg_log_dens</cite> function specifies the
(negative logarithm) of the density of the target distribution with
respect to the Hausdorff measure on the manifold directly (True) or
alternatively the negative logarithm of a density of a prior
distriubtion on the unconstrained (ambient) position space with respect
to the Lebesgue measure, with the target distribution then corresponding
to the posterior distribution when conditioning on the event <cite>const(pos)
== 0</cite> (False). Note that in the former case the base Hausdorff measure
on the manifold depends on the metric defined on the ambient space, with
the Hausdorff measure being defined with respect to the metric induced
on the manifold from this ambient metric.</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct a function
to compute the derivative (and value) of <cite>neg_log_dens</cite> automatically.</p></li>
<li><p><strong>jacob_constr</strong> (<em>Optional</em><em>[</em><em>JacobianFunction</em><em>]</em>) – <dl class="simple">
<dt>Function which given a position array computes the Jacobian</dt><dd><p>(matrix / 2D array of partial derivatives) of the output of the
constraint function <cite>c = constr(q)</cite> with respect to the position array
argument <cite>q</cite>, returning the computed Jacobian as a 2D array <cite>jacob</cite> with</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    jacob[i, j] = ∂c[i] / ∂q[j]

Optionally the function may instead return a 2-tuple of values with the
first being the array corresponding to the Jacobian and the second being
the value of `constr` evaluated at the passed position array. If `None`
is passed (the default) an automatic differentiation fallback will be
used to attempt to construct a function to compute the Jacobian (and
value) of `neg_log_dens` automatically.
</pre></div>
</div>
</p></li>
<li><p><strong>mhp_constr</strong> (<em>Optional</em><em>[</em><em>MatrixHessianProductFunction</em><em>]</em>) – <dl class="simple">
<dt>Function which given a position array returns another function</dt><dd><p>which takes a 2D array as an argument and returns the
<em>matrix-Hessian-product</em> (MHP) of the constraint function <cite>constr</cite> with
respect to the position array argument. The MHP is here defined as a
function of a <cite>(dim_constr, dim_pos)</cite> shaped 2D array <cite>m</cite></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    mhp(m) = sum(m[:, :, None] * hess[:, :, :], axis=(0, 1))

where `hess` is the `(dim_constr, dim_pos, dim_pos)` shaped
vector-Hessian of `c = constr(q)` with respect to `q` i.e. the array of
second-order partial derivatives of such that
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    hess[i, j, k] = ∂²c[i] / (∂q[j] ∂q[k])

Optionally the function may instead return a 3-tuple of values with the
first a function to compute a MHP of `constr`, the second a 2D array
corresponding to the Jacobian of `constr`, and the third the value of
`constr`, all evaluated at the passed position array. If `None` is
passed (the default) an automatic differentiation fallback will be used
to attempt to construct a function which calculates the MHP (and
Jacobian and value) of `constr` automatically.
</pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.constr">
<span class="sig-name descname"><span class="pre">constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.constr" title="Permalink to this definition"></a></dt>
<dd><p>Constraint function at the current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>constr(state.pos)</cite> as 1D array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.dh2_flow_dmom">
<span class="sig-name descname"><span class="pre">dh2_flow_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.dh2_flow_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivatives of <cite>h2_flow</cite> flow map with respect to input momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval flow simulated for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Matrix representing derivative (Jacobian) of position output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
<dt>dmom_dmom: Matrix representing derivative (Jacobian) of momentum output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dpos_dmom</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram">
<span class="sig-name descname"><span class="pre">grad_log_det_sqrt_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#DenseConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of (half of) log-determinant of Gram matrix wrt position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>log_det_sqrt_gram(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.gram">
<span class="sig-name descname"><span class="pre">gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.gram" title="Permalink to this definition"></a></dt>
<dd><p>Gram matrix at current position.</p>
<p>The Gram matrix as a position <cite>q</cite> is defined as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gram</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">@</span> <span class="n">inv</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span> <span class="o">@</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>where <cite>jacob_constr</cite> is the Jacobian of the constraint function <cite>constr</cite> and
<cite>metric</cite> is the matrix representation of the metric on the ambient space.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Gram matrix as matrix object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.h2_flow">
<span class="sig-name descname"><span class="pre">h2_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.h2_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h2</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.inv_gram">
<span class="sig-name descname"><span class="pre">inv_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.inv_gram" title="Permalink to this definition"></a></dt>
<dd><p>Inverse of Gram matrix at current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Inverse of Gram matrix as matrix object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.jacob_constr">
<span class="sig-name descname"><span class="pre">jacob_constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.jacob_constr" title="Permalink to this definition"></a></dt>
<dd><p>Jacobian of constraint function at the current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Jacobian of <cite>constr(state.pos)</cite> as 2D array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.jacob_constr_inner_product">
<span class="sig-name descname"><span class="pre">jacob_constr_inner_product</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jacob_constr_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inner_product_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jacob_constr_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#DenseConstrainedEuclideanMetricSystem.jacob_constr_inner_product"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.jacob_constr_inner_product" title="Permalink to this definition"></a></dt>
<dd><p>Compute inner product of rows of constraint Jacobian matrices.</p>
<p>Computes <cite>jacob_constr_1 &#64; inner_product_matrix &#64; jacob_constr_2.T</cite> potentially
exploiting any structure / sparsity in <cite>jacob_constr_1</cite>, <cite>jacob_constr_2</cite> and
<cite>inner_product_matrix</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>jacob_constr_1</strong> (<em>MatrixLike</em>) – First constraint Jacobian in product.</p></li>
<li><p><strong>inner_product_matrix</strong> (<a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a>) – Positive-definite matrix defining inner-product
between rows of two constraint Jacobians.</p></li>
<li><p><strong>jacob_constr_2</strong> (<em>Optional</em><em>[</em><em>MatrixLike</em><em>]</em>) – Second constraint Jacobian in product. Defaults to
<cite>jacob_constr_1</cite> if set to <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>MatrixLike</p>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>Object corresponding to computed inner products of the constraint Jacobian
rows.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.log_det_sqrt_gram">
<span class="sig-name descname"><span class="pre">log_det_sqrt_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.log_det_sqrt_gram" title="Permalink to this definition"></a></dt>
<dd><p>Value of (half of) log-determinant of Gram matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.mhp_constr">
<span class="sig-name descname"><span class="pre">mhp_constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#DenseConstrainedEuclideanMetricSystem.mhp_constr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.mhp_constr" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>MatrixHessianProduct</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.project_onto_cotangent_space">
<span class="sig-name descname"><span class="pre">project_onto_cotangent_space</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.project_onto_cotangent_space" title="Permalink to this definition"></a></dt>
<dd><p>Project a momentum on to the co-tangent space at a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mom</strong> (<em>ArrayLike</em>) – Momentum (co-)vector as 1D array to project on to co-tangent space.</p></li>
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State definining position on the  manifold to project in to the
co-tangent space of.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Projected momentum in the co-tangent space at <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseConstrainedEuclideanMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseConstrainedEuclideanMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">DenseRiemannianMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vjp_metric_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#DenseRiemannianMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.RiemannianMetricSystem" title="mici.systems.RiemannianMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">RiemannianMetricSystem</span></code></a></p>
<p>Riemannian-metric system with dense matrix representation.</p>
<p>Hamiltonian system with a position dependent metric matrix representation which is
specified to be a dense matrix function <cite>metric_func</cite> of the position <cite>q</cite> which is
guaranteed to be positive definite almost-everywhere, with <cite>M = metric_func(q)</cite> then
the metric matrix representation.</p>
<p>See documentation of <cite>RiemannianMetricSystem</cite> for more general details about
Riemannian-metric Hamiltonian systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>metric_func</strong> (<em>ArrayFunction</em>) – Function which given a position array returns a 2D array
corresponding to the positive definite metric matrix representation. The
returned matrices (2D arrays) are assumed to be positive-definite for
all input positions and a <cite>LinAlgError</cite> exception may be raised if this
fails to be the case.</p></li>
<li><p><strong>vjp_metric_func</strong> (<em>Optional</em><em>[</em><em>VectorJacobianProductFunction</em><em>]</em>) – <p>Function which given a position array returns another
function which takes a 2D array as an argument and returns the
<em>vector-Jacobian-product</em> (VJP) of <cite>metric_func</cite> with respect to the
position array argument. The VJP is here defined as a function of a 2D
array <cite>v</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the <cite>(dim_pos, dim_pos, dim_pos)</cite> shaped Jacobian of <cite>M
= metric_func(q)</cite> with respect to <cite>q</cite> i.e. the array of partial
derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[i, j, k] = ∂M[i, j] / ∂q[k]
</pre></div>
</div>
<p>Optionally the function may instead return a 2-tuple of values with the
first a function to compute a VJP of <cite>metric_func</cite> and the second a 2D
array containing the value of <cite>metric_func</cite>, both evaluated at the
passed position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct a function
which calculates the VJP (and value) of <cite>metric_func</cite> automatically.</p>
</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.metric" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the metric matrix representation.</p>
<p>The returned type of this function is that specified by the
<cite>metric_matrix_class</cite> argument to the initializer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Metric matrix representation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.metric_func">
<span class="sig-name descname"><span class="pre">metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the parameter of the metric matrix representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>metric_func(state.pos)</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DenseRiemannianMetricSystem.vjp_metric_func">
<span class="sig-name descname"><span class="pre">vjp_metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DenseRiemannianMetricSystem.vjp_metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function constructing a vector-Jacobian-product for <cite>metric_func</cite>.</p>
<p>The vector-Jacobian-product is here defined as a function of an array <cite>v</cite> (of
the same shape as the output of <cite>metric_func</cite>) corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the Jacobian of <cite>m = metric_func(q)</cite> wrt <cite>q</cite> i.e. the array of
partial derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[..., i] = ∂m[...] / ∂q[i]
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute VJP at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vector-Jacobian-product function.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>VectorJacobianProduct</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">DiagonalRiemannianMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_diagonal_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vjp_metric_diagonal_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#DiagonalRiemannianMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.RiemannianMetricSystem" title="mici.systems.RiemannianMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">RiemannianMetricSystem</span></code></a></p>
<p>Riemannian-metric system with diagonal matrix representation.</p>
<p>Hamiltonian system with a position dependent diagonal metric matrix representation
which is specified by a vector-valued function <cite>metric_diagonal_func</cite> of the
position <cite>q</cite> which outputs a 1D array with strictly positive elements <cite>d =
metric_diagonal_func(q)</cite> with the metric matrix representation then taken to be
<cite>diag(d)</cite>.</p>
<p>See documentation of <cite>RiemannianMetricSystem</cite> for more general details about
Riemannian-metric Hamiltonian systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>metric_diagonal_func</strong> (<em>ArrayFunction</em>) – Function which given a position array returns a 1D
array with strictly positive values corresponding to the diagonal values
(left-to-right) of the diagonal metric matrix representation.</p></li>
<li><p><strong>vjp_metric_diagonal_func</strong> (<em>Optional</em><em>[</em><em>VectorJacobianProductFunction</em><em>]</em>) – <p>Function which given a position array returns
another function which takes a 1D array as an argument and returns the
<em>vector-Jacobian-product</em> (VJP) of <cite>metric_diagonal_func</cite> with respect
to the position array argument. The VJP is here defined as a function of
a 1D array <cite>v</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the <cite>(dim_pos, dim_pos)</cite> shaped Jacobian of <cite>d =
metric_diagonal_func(q)</cite> with respect to <cite>q</cite> i.e. the array of partial
derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[i, j] = ∂d[i] / ∂q[j]
</pre></div>
</div>
<p>Optionally the function may instead return a 2-tuple of values with the
first a function to compute a VJP of <cite>metric_diagonal_func</cite> and the
second a 1D array containing the value of <cite>metric_diagonal_func</cite>, both
evaluated at the passed position array. If <cite>None</cite> is passed (the
default) an automatic differentiation fallback will be used to attempt
to construct a function which calculates the VJP (and value) of
<cite>metric_diagonal_func</cite> automatically.</p>
</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.metric" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the metric matrix representation.</p>
<p>The returned type of this function is that specified by the
<cite>metric_matrix_class</cite> argument to the initializer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Metric matrix representation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.metric_func">
<span class="sig-name descname"><span class="pre">metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the parameter of the metric matrix representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>metric_func(state.pos)</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.DiagonalRiemannianMetricSystem.vjp_metric_func">
<span class="sig-name descname"><span class="pre">vjp_metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.DiagonalRiemannianMetricSystem.vjp_metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function constructing a vector-Jacobian-product for <cite>metric_func</cite>.</p>
<p>The vector-Jacobian-product is here defined as a function of an array <cite>v</cite> (of
the same shape as the output of <cite>metric_func</cite>) corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the Jacobian of <cite>m = metric_func(q)</cite> wrt <cite>q</cite> i.e. the array of
partial derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[..., i] = ∂m[...] / ∂q[i]
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute VJP at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vector-Jacobian-product function.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>VectorJacobianProduct</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">EuclideanMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.System" title="mici.systems.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a></p>
<p>Hamiltonian system with a Euclidean metric on the position space.</p>
<p>Here Euclidean metric is defined to mean a metric with a fixed positive definite
matrix representation <span class="math notranslate nohighlight">\(M\)</span>. The momentum variables are taken to be independent
of the position variables and with a zero-mean Gaussian marginal distribution with
covariance specified by <span class="math notranslate nohighlight">\(M\)</span>, so that the <span class="math notranslate nohighlight">\(h_2\)</span> Hamiltonian component is</p>
<div class="math notranslate nohighlight">
\[h_2(q, p) = \frac{1}{2} p^T M^{-1} p\]</div>
<p>where <span class="math notranslate nohighlight">\(q\)</span> and <span class="math notranslate nohighlight">\(p\)</span> are the position and momentum variables respectively.</p>
<p>The <span class="math notranslate nohighlight">\(h_1\)</span> Hamiltonian component function is</p>
<div class="math notranslate nohighlight">
\[h_1(q) = \ell(q)\]</div>
<p>where <span class="math notranslate nohighlight">\(\ell(q)\)</span> is the negative log (unnormalized) density of the target
distribution with respect to the Lebesgue measure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>metric</strong> (<em>Optional</em><em>[</em><em>MetricLike</em><em>]</em>) – Matrix object corresponding to matrix representation of metric on
position space and covariance of Gaussian marginal distribution on
momentum vector. If <cite>None</cite> is passed (the default), the identity matrix
will be used. If a 1D array is passed then this is assumed to specify a
metric with positive diagonal matrix representation and the array the
matrix diagonal. If a 2D array is passed then this is assumed to specify
a metric with a dense positive definite matrix representation specified
by the array. Otherwise if the value is a subclass of
<cite>mici.matrices.PositiveDefiniteMatrix</cite> it is assumed to directly specify
the metric matrix representation.</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem.dh2_dmom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem.dh2_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.dh2_flow_dmom">
<span class="sig-name descname"><span class="pre">dh2_flow_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem.dh2_flow_dmom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.dh2_flow_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivatives of <cite>h2_flow</cite> flow map with respect to input momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval flow simulated for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Matrix representing derivative (Jacobian) of position output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
<dt>dmom_dmom: Matrix representing derivative (Jacobian) of momentum output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dpos_dmom</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem.dh_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem.h2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.h2_flow">
<span class="sig-name descname"><span class="pre">h2_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem.h2_flow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.h2_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h2</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.EuclideanMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#EuclideanMetricSystem.sample_momentum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.EuclideanMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">GaussianDenseConstrainedEuclideanMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jacob_constr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mhp_constr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianDenseConstrainedEuclideanMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.GaussianEuclideanMetricSystem" title="mici.systems.GaussianEuclideanMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">GaussianEuclideanMetricSystem</span></code></a>, <a class="reference internal" href="#mici.systems.DenseConstrainedEuclideanMetricSystem" title="mici.systems.DenseConstrainedEuclideanMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">DenseConstrainedEuclideanMetricSystem</span></code></a></p>
<p>Gaussian Euclidean Hamiltonian system st. a dense set of constraints.</p>
<p>See <cite>ConstrainedEuclideanMetricSystem</cite> for more details about constrained
systems and <cite>GaussianEuclideanMetricSystem</cite> for Gaussian Euclidean metric
systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – <p>Function which given a position array returns the negative
logarithm of an unnormalized probability density on the unconstrained
(ambient) position space with respect to the standard Gaussian measure.
The density function is taken to specify a prior distribution on the
ambient space with the target distribution then corresponding to the
posterior distribution when conditioning on the (zero Lebesgue measure)
event <cite>constr(pos) == 0</cite>. This target posterior distribution has support
on the differentiable manifold implicitly defined by the constraint
equation, with density with respect to the Hausdorff measure on the
manifold corresponding to the ratio of the prior density (specified by
<cite>neg_log_dens</cite>) and the square-root of the determinant of the Gram
matrix defined by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gram</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">@</span> <span class="n">inv</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span> <span class="o">@</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>where <cite>jacob_constr</cite> is the Jacobian of the constraint function <cite>constr</cite>
and <cite>metric</cite> is the matrix representation of the metric on the ambient
space.</p>
</p></li>
<li><p><strong>constr</strong> (<em>ArrayFunction</em>) – Function which given a position array return as a 1D array the value
of the (vector-valued) constraint function, the zero level-set of which
implicitly defines the manifold the dynamic is simulated on.</p></li>
<li><p><strong>metric</strong> (<em>Optional</em><em>[</em><em>MetricLike</em><em>]</em>) – Matrix object corresponding to matrix representation of metric on
<em>unconstrained</em> position space and covariance of Gaussian marginal
distribution on <em>unconstrained</em> momentum vector. If <cite>None</cite> is passed
(the default), the identity matrix will be used. If a 1D array is passed
then this is assumed to specify a metric with positive diagonal matrix
representation and the array the matrix diagonal. If a 2D array is
passed then this is assumed to specify a metric with a dense positive
definite matrix representation specified by the array. Otherwise if a
subclass of <cite>mici.matrices.PositiveDefiniteMatrix</cite> it is assumed to
directly specify the metric matrix representation.</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct a function
to compute the derivative (and value) of <cite>neg_log_dens</cite> automatically.</p></li>
<li><p><strong>jacob_constr</strong> (<em>Optional</em><em>[</em><em>JacobianFunction</em><em>]</em>) – <p>Function which given a position array computes the Jacobian
(matrix / 2D array of partial derivatives) of the output of the
constraint function <cite>c = constr(q)</cite> with respect to the position array
argument <cite>q</cite>, returning the computed Jacobian as a 2D array <cite>jacob</cite> with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[i, j] = ∂c[i] / ∂q[j]
</pre></div>
</div>
<p>Optionally the function may instead return a 2-tuple of values with the
first being the array corresponding to the Jacobian and the second being
the value of <cite>constr</cite> evaluated at the passed position array. If <cite>None</cite>
is passed (the default) an automatic differentiation fallback will be
used to attempt to construct a function to compute the Jacobian (and
value) of <cite>neg_log_dens</cite> automatically.</p>
</p></li>
<li><p><strong>mhp_constr</strong> (<em>Optional</em><em>[</em><em>MatrixHessianProductFunction</em><em>]</em>) – <p>Function which given a position array returns another function
which takes a 2D array as an argument and returns the
<em>matrix-Hessian-product</em> (MHP) of the constraint function <cite>constr</cite> with
respect to the position array argument. The MHP is here defined as a
function of a <cite>(dim_constr, dim_pos)</cite> shaped 2D array <cite>m</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mhp</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">hess</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>hess</cite> is the <cite>(dim_constr, dim_pos, dim_pos)</cite> shaped
vector-Hessian of <cite>c = constr(q)</cite> with respect to <cite>q</cite> i.e. the array of
second-order partial derivatives of such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>hess[i, j, k] = ∂²c[i] / (∂q[j] ∂q[k])
</pre></div>
</div>
<p>Optionally the function may instead return a 3-tuple of values with the
first a function to compute a MHP of <cite>constr</cite>, the second a 2D array
corresponding to the Jacobian of <cite>constr</cite>, and the third the value of
<cite>constr</cite>, all evaluated at the passed position array. If <cite>None</cite> is
passed (the default) an automatic differentiation fallback will be used
to attempt to construct a function which calculates the MHP (and
Jacobian and value) of <cite>constr</cite> automatically.</p>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.constr">
<span class="sig-name descname"><span class="pre">constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.constr" title="Permalink to this definition"></a></dt>
<dd><p>Constraint function at the current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>constr(state.pos)</cite> as 1D array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh2_flow_dmom">
<span class="sig-name descname"><span class="pre">dh2_flow_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh2_flow_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivatives of <cite>h2_flow</cite> flow map with respect to input momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval flow simulated for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Matrix representing derivative (Jacobian) of position output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
<dt>dmom_dmom: Matrix representing derivative (Jacobian) of momentum output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dpos_dmom</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram">
<span class="sig-name descname"><span class="pre">grad_log_det_sqrt_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.grad_log_det_sqrt_gram" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of (half of) log-determinant of Gram matrix wrt position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>log_det_sqrt_gram(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.gram">
<span class="sig-name descname"><span class="pre">gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.gram" title="Permalink to this definition"></a></dt>
<dd><p>Gram matrix at current position.</p>
<p>The Gram matrix as a position <cite>q</cite> is defined as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gram</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">@</span> <span class="n">inv</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span> <span class="o">@</span> <span class="n">jacob_constr</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>where <cite>jacob_constr</cite> is the Jacobian of the constraint function <cite>constr</cite> and
<cite>metric</cite> is the matrix representation of the metric on the ambient space.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Gram matrix as matrix object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h2_flow">
<span class="sig-name descname"><span class="pre">h2_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.h2_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h2</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.inv_gram">
<span class="sig-name descname"><span class="pre">inv_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.inv_gram" title="Permalink to this definition"></a></dt>
<dd><p>Inverse of Gram matrix at current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Inverse of Gram matrix as matrix object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.jacob_constr">
<span class="sig-name descname"><span class="pre">jacob_constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.jacob_constr" title="Permalink to this definition"></a></dt>
<dd><p>Jacobian of constraint function at the current position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Jacobian of <cite>constr(state.pos)</cite> as 2D array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.jacob_constr_inner_product">
<span class="sig-name descname"><span class="pre">jacob_constr_inner_product</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jacob_constr_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inner_product_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jacob_constr_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianDenseConstrainedEuclideanMetricSystem.jacob_constr_inner_product"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.jacob_constr_inner_product" title="Permalink to this definition"></a></dt>
<dd><p>Compute inner product of rows of constraint Jacobian matrices.</p>
<p>Computes <cite>jacob_constr_1 &#64; inner_product_matrix &#64; jacob_constr_2.T</cite> potentially
exploiting any structure / sparsity in <cite>jacob_constr_1</cite>, <cite>jacob_constr_2</cite> and
<cite>inner_product_matrix</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>jacob_constr_1</strong> (<em>MatrixLike</em>) – First constraint Jacobian in product.</p></li>
<li><p><strong>inner_product_matrix</strong> (<a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a>) – Positive-definite matrix defining inner-product
between rows of two constraint Jacobians.</p></li>
<li><p><strong>jacob_constr_2</strong> (<em>Optional</em><em>[</em><em>MatrixLike</em><em>]</em>) – Second constraint Jacobian in product. Defaults to
<cite>jacob_constr_1</cite> if set to <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>MatrixLike</p>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>Object corresponding to computed inner products of the constraint Jacobian
rows.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.log_det_sqrt_gram">
<span class="sig-name descname"><span class="pre">log_det_sqrt_gram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.log_det_sqrt_gram" title="Permalink to this definition"></a></dt>
<dd><p>Value of (half of) log-determinant of Gram matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.mhp_constr">
<span class="sig-name descname"><span class="pre">mhp_constr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.mhp_constr" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – </p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>MatrixHessianProduct</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.project_onto_cotangent_space">
<span class="sig-name descname"><span class="pre">project_onto_cotangent_space</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.project_onto_cotangent_space" title="Permalink to this definition"></a></dt>
<dd><p>Project a momentum on to the co-tangent space at a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mom</strong> (<em>ArrayLike</em>) – Momentum (co-)vector as 1D array to project on to co-tangent space.</p></li>
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State definining position on the  manifold to project in to the
co-tangent space of.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Projected momentum in the co-tangent space at <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianDenseConstrainedEuclideanMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">GaussianEuclideanMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianEuclideanMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.EuclideanMetricSystem" title="mici.systems.EuclideanMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">EuclideanMetricSystem</span></code></a></p>
<p>Euclidean Hamiltonian system with a tractable Gaussian component.</p>
<p>Here Euclidean metric is defined to mean a metric with a fixed positive definite
matrix representation <span class="math notranslate nohighlight">\(M\)</span>. The momentum variables are taken to be independent
of the position variables and with a zero-mean Gaussian marginal distribution with
covariance specified by <span class="math notranslate nohighlight">\(M\)</span>.</p>
<p>Additionally the target distribution on the position variables is assumed to be
defined by an unnormalized density with respect to the standard Gaussian measure on
the position space (with identity covariance and zero mean), with the Hamiltonian
component <span class="math notranslate nohighlight">\(h_1\)</span> corresponding to the negative logarithm of this density rather
than the density with respect to the Lebesgue measure on the position space, i.e.</p>
<div class="math notranslate nohighlight">
\[h_1(q) = \ell(q) - \frac{1}{2} q^T q\]</div>
<p>where <span class="math notranslate nohighlight">\(q\)</span> is the position and <span class="math notranslate nohighlight">\(\ell(q)\)</span> is the negative log
(unnormalized) density of the target distribution with respect to the Lebesgue
measure at <span class="math notranslate nohighlight">\(q\)</span>. The Hamiltonian  component function <span class="math notranslate nohighlight">\(h_2\)</span> is then
assumed to have the form</p>
<div class="math notranslate nohighlight">
\[h_2(q, p) = \frac{1}{2} q^T q + \frac{1}{2} p^T M^{-1} p\]</div>
<p>where <span class="math notranslate nohighlight">\(p\)</span> is the momentum. In this case the Hamiltonian flow due to the
quadratic <span class="math notranslate nohighlight">\(h_2\)</span> component can be solved for analytically, allowing an
integrator to be defined using this alternative splitting of the Hamiltonian [1].</p>
<p class="rubric">References</p>
<ol class="arabic simple">
<li><p>Shahbaba, B., Lan, S., Johnson, W.O. and Neal, R.M., 2014. Split Hamiltonian
Monte Carlo. Statistics and Computing, 24(3), pp.339-349.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the standard Gaussian measure on the position space,
with the corresponding distribution on the position space being the
target distribution it is wished to draw approximate samples from.</p></li>
<li><p><strong>metric</strong> (<em>Optional</em><em>[</em><em>MetricLike</em><em>]</em>) – Matrix object corresponding to matrix representation of metric on
position space and covariance of Gaussian marginal distribution on
momentum vector. If <cite>None</cite> is passed (the default), the identity matrix
will be used. If a 1D array is passed then this is assumed to specify a
metric with positive diagonal matrix representation and the array the
matrix diagonal. If a 2D array is passed then this is assumed to specify
a metric with a dense positive definite matrix representation specified
by the array. Otherwise if the value is a subclass of
<cite>mici.matrices.PositiveDefiniteMatrix</cite> it is assumed to directly specify
the metric matrix representation.</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianEuclideanMetricSystem.dh2_dmom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianEuclideanMetricSystem.dh2_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.dh2_flow_dmom">
<span class="sig-name descname"><span class="pre">dh2_flow_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianEuclideanMetricSystem.dh2_flow_dmom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.dh2_flow_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivatives of <cite>h2_flow</cite> flow map with respect to input momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval flow simulated for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Matrix representing derivative (Jacobian) of position output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
<dt>dmom_dmom: Matrix representing derivative (Jacobian) of momentum output of</dt><dd><p><cite>h2_flow</cite> with respect to the value of the momentum component of the
initial input state.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dpos_dmom</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianEuclideanMetricSystem.h2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.h2_flow">
<span class="sig-name descname"><span class="pre">h2_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#GaussianEuclideanMetricSystem.h2_flow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.h2_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h2</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.GaussianEuclideanMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.GaussianEuclideanMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">RiemannianMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_matrix_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vjp_metric_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.System" title="mici.systems.System"><code class="xref py py-class docutils literal notranslate"><span class="pre">System</span></code></a></p>
<p>Riemannian Hamiltonian system with a position-dependent metric.</p>
<p>This class allows for metric matrix representations of any generic type. In most
cases a specialized subclass such as <cite>DenseRiemannianMetricSystem</cite>,
<cite>CholeskyFactoredRiemannianMetricSystem</cite>, <cite>DiagonalRiemannianMetricSystem</cite>,
<cite>ScalarRiemannianMetricSystem</cite> or <cite>SoftAbsRiemannianMetricSystem</cite> will provide a
simpler method of constructng a system with a metric matrix representation of a
specific type.</p>
<p>The position space is assumed to be a Riemannian manifold with a metric with
position-dependent positive definite matrix-representation <span class="math notranslate nohighlight">\(M(q)\)</span> where
<span class="math notranslate nohighlight">\(q\)</span> is a position vector. The momentum <span class="math notranslate nohighlight">\(p\)</span> is then taken to have a
zero-mean Gaussian conditional distribution given the position <span class="math notranslate nohighlight">\(q\)</span>, with
covariance <span class="math notranslate nohighlight">\(M(q)\)</span>, i.e. <span class="math notranslate nohighlight">\(p \sim \mathcal{N}(0, M(q))\)</span> [1].</p>
<p>The <span class="math notranslate nohighlight">\(h_1\)</span> Hamiltonian component is then</p>
<div class="math notranslate nohighlight">
\[h_1(q) = \ell(q) + \frac{1}{2}\log\left|M(q)\right|\]</div>
<p>where <span class="math notranslate nohighlight">\(\ell(q)\)</span> is the negative log (unnormalized) density of the target
distribution with respect to the Lebesgue measure at <span class="math notranslate nohighlight">\(q\)</span>. The <span class="math notranslate nohighlight">\(h_2\)</span>
Hamiltonian component is</p>
<div class="math notranslate nohighlight">
\[h_2(q, p) = \frac{1}{2} p^T (M(q))^{-1} p.\]</div>
<p>Due to the coupling between the position and momentum variables in <span class="math notranslate nohighlight">\(h_2\)</span>, the
Hamiltonian system is non-separable, requiring use of a numerical integrator with
implicit steps when simulating the Hamiltonian dynamic associated with the system,
e.g. <cite>mici.integrators.ImplicitLeapfrogIntegrator</cite>.</p>
<p class="rubric">References</p>
<ol class="arabic simple">
<li><p>Girolami, M. and Calderhead, B., 2011. Riemann manifold Langevin and
Hamiltonian Monte Varlo methods. Journal of the Royal Statistical Society:
Series B (Statistical Methodology), 73(2), pp.123-214.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>metric_matrix_class</strong> (<em>Type</em><em>[</em><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a><em>]</em>) – <p>Class (or factory function returning an instance of the
class) which defines type of matrix representation of metric. The class
initializer should take a single positional argument which will be
passed the array outputted by <cite>metric_func</cite>, and which is assumed to be
a parameter which fully defines the resulting matrix (e.g. the diagonal
of a <cite>mici.matrices.DiagonalMatrix</cite>). The class initializer may also
optionally take one or more keyword arguments, with the <cite>metric_kwargs</cite>
argument used to specify the value of these, if any. Together this means
the metric matrix representation at a position <cite>pos</cite> is constructed as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric_matrix_class</span><span class="p">(</span><span class="n">metric_func</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="o">**</span><span class="n">metric_kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>mici.matrices.PositiveDefiniteMatrix</cite> subclass should as a minimum
define <cite>inv</cite>, <cite>log_abs_det</cite>, <cite>grad_log_abs_det</cite>,
<cite>grad_quadratic_form_inv</cite>, <cite>__matmul__</cite> and <cite>__rmatmul__</cite> methods /
properties (see documentation of <cite>mici.matrices.PositiveDefiniteMatrix</cite>
and <cite>mici.matrices.DifferentiableMatrix</cite> for definitions of the expected
behaviour of these methods).</p>
</p></li>
<li><p><strong>metric_func</strong> (<em>ArrayFunction</em>) – Function which given a position array returns an array
containing the parameter value of the metric matrix representation
passed as the single positional argument to the <cite>metric_matrix_class</cite>
initializer.</p></li>
<li><p><strong>vjp_metric_func</strong> (<em>Optional</em><em>[</em><em>VectorJacobianProductFunction</em><em>]</em>) – <p>Function which given a position array returns another
function which takes an array as an argument and returns the
<strong>vector-Jacobian-product</strong> (VJP) of <cite>metric_func</cite> with respect to the
position array argument. The VJP is here defined as a function of an
array <cite>v</cite> (of the same shape as the output of <cite>metric_func</cite>)
corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the Jacobian of <cite>m = metric_func(q)</cite> wrt <cite>q</cite> i.e. the
array of partial derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[..., i] = ∂m[...] / ∂q[i]
</pre></div>
</div>
<p>Optionally the function may instead return a 2-tuple of values with the
first a function to compute a VJP of <cite>metric_func</cite> and the second an
array containing the value of <cite>metric_func</cite>, both evaluated at the
passed position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct a function
which calculates the VJP (and value) of <cite>metric_func</cite> automatically.</p>
</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
<li><p><strong>metric_kwargs</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>, </em><em>Any</em><em>]</em><em>]</em>) – An optional dictionary of any additional keyword arguments to
the initializer of <cite>metric_matrix_class</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.dh1_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.dh2_dmom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.dh2_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.h"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.h1"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.h2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.metric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.metric" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the metric matrix representation.</p>
<p>The returned type of this function is that specified by the
<cite>metric_matrix_class</cite> argument to the initializer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Metric matrix representation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.metric_func">
<span class="sig-name descname"><span class="pre">metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.metric_func"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the parameter of the metric matrix representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>metric_func(state.pos)</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.sample_momentum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.RiemannianMetricSystem.vjp_metric_func">
<span class="sig-name descname"><span class="pre">vjp_metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#RiemannianMetricSystem.vjp_metric_func"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.RiemannianMetricSystem.vjp_metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function constructing a vector-Jacobian-product for <cite>metric_func</cite>.</p>
<p>The vector-Jacobian-product is here defined as a function of an array <cite>v</cite> (of
the same shape as the output of <cite>metric_func</cite>) corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the Jacobian of <cite>m = metric_func(q)</cite> wrt <cite>q</cite> i.e. the array of
partial derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[..., i] = ∂m[...] / ∂q[i]
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute VJP at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vector-Jacobian-product function.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>VectorJacobianProduct</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">ScalarRiemannianMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_scalar_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vjp_metric_scalar_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ScalarRiemannianMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.RiemannianMetricSystem" title="mici.systems.RiemannianMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">RiemannianMetricSystem</span></code></a></p>
<p>Riemannian-metric system with scaled identity matrix representation.</p>
<p>Hamiltonian system with a position dependent scaled identity metric matrix
representation which is specified by a scalar function <cite>metric_scalar_function</cite> of
the position <cite>q</cite> which outputs a strictly positive scalar <cite>s =
metric_scalar_func(q)</cite> with the the metric matrix representation then taken to be <cite>s
* identity(q.shape[0])</cite>.</p>
<p>See documentation of <cite>RiemannianMetricSystem</cite> for more general details about
Riemannian-metric Hamiltonian systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>metric_scalar_func</strong> (<em>ScalarFunction</em>) – Function which given a position array returns a strictly
positive scalar corresponding to the parameter value of the scaled
identity metric matrix representation.</p></li>
<li><p><strong>vjp_metric_scalar_func</strong> (<em>Optional</em><em>[</em><em>VectorJacobianProductFunction</em><em>]</em>) – <p>Function which given a position array returns
another function which takes a scalar as an argument and returns the
<em>vector-Jacobian-product</em> (VJP) of <cite>metric_scalar_func</cite> with respect to
the position array argument. The VJP is here defined as a function of a
scalar <cite>v</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span> <span class="o">@</span> <span class="n">grad</span>
</pre></div>
</div>
<p>where <cite>grad</cite> is the <cite>(dim_pos,)</cite> shaped Jacobian (gradient) of <cite>s =
metric_scalar_func(q)</cite> with respect to <cite>q</cite> i.e. the array of partial
derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grad[i] = ∂s / ∂q[i]
</pre></div>
</div>
<p>Optionally the function may instead return a 2-tuple of values with the
first a function to compute a VJP of <cite>metric_scalar_func</cite> and the second
a float containing the value of <cite>metric_scalar_func</cite>, both evaluated at
the passed position array. If <cite>None</cite> is passed (the default) an
automatic differentiation fallback will be used to attempt to construct
a function which calculates the VJP (and value) of <cite>metric_scalar_func</cite>
automatically.</p>
</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#ScalarRiemannianMetricSystem.metric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.metric" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the metric matrix representation.</p>
<p>The returned type of this function is that specified by the
<cite>metric_matrix_class</cite> argument to the initializer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Metric matrix representation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.metric_func">
<span class="sig-name descname"><span class="pre">metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the parameter of the metric matrix representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>metric_func(state.pos)</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.ScalarRiemannianMetricSystem.vjp_metric_func">
<span class="sig-name descname"><span class="pre">vjp_metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.ScalarRiemannianMetricSystem.vjp_metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function constructing a vector-Jacobian-product for <cite>metric_func</cite>.</p>
<p>The vector-Jacobian-product is here defined as a function of an array <cite>v</cite> (of
the same shape as the output of <cite>metric_func</cite>) corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the Jacobian of <cite>m = metric_func(q)</cite> wrt <cite>q</cite> i.e. the array of
partial derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[..., i] = ∂m[...] / ∂q[i]
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute VJP at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vector-Jacobian-product function.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>VectorJacobianProduct</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">SoftAbsRiemannianMetricSystem</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hess_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mtp_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">softabs_coeff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#SoftAbsRiemannianMetricSystem"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mici.systems.RiemannianMetricSystem" title="mici.systems.RiemannianMetricSystem"><code class="xref py py-class docutils literal notranslate"><span class="pre">RiemannianMetricSystem</span></code></a></p>
<p>SoftAbs Riemmanian metric Hamiltonian system.</p>
<p>Hamiltonian system with a position dependent metric matrix representation which is
specified to be a dense matrix function <cite>metric_func</cite> of the position <cite>q</cite> which is
guaranteed to be positive definite almost-everywhere, with <cite>M = metric_func(q)</cite> then
the metric matrix representation.</p>
<p>Hamiltonian system with a position dependent metric matrix representation which is
specified to be an eigenvalue-regularized transformation of the Hessian of the
negative log density function (the symmetric matrix of second derivatives the
negative log density function with respect to the position array components.
Specifically if <cite>hess_neg_log_dens</cite> is a symmetric 2D square array valued function
of the position <cite>q</cite>, with <cite>H = hess_neg_log_dens(q)</cite> then if an eigenvalue
decomposition of <cite>H</cite> is computed, i.e. <cite>eigval, eigvec = eigh(H)</cite>, with <cite>eigval</cite> a
1D array of real eigenvalues, and <cite>eigvec</cite> the corresponding 2D array (orthogonal
matrix) with eigenvectors as columns, then the resulting positive-definite metric
matrix representation <cite>M</cite> is computed as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">eigvec</span> <span class="o">@</span> <span class="n">diag</span><span class="p">(</span><span class="n">softabs</span><span class="p">(</span><span class="n">eigval</span><span class="p">,</span> <span class="n">softabs_coeff</span><span class="p">))</span> <span class="o">@</span> <span class="n">eigvec</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>with <cite>softabs(x, softabs_coeff) = x / tanh(x * softabs_coeff)</cite> an elementwise
function which acts as a smooth approximation to the absolute function (ensuring all
the eigenvalues of <cite>M</cite> are strictly positive) with the additional scalar parameter
<cite>softabs_coeff</cite> controlling the smoothness of the approximation, with <cite>softabs</cite>
tending to the piecewise linear <cite>abs</cite> function as <cite>softabs_coeff</cite> tends to infinity,
and becoming increasingly smooth as <cite>softabs_coeff</cite> tends to zero.</p>
<p>See documentation of <cite>RiemannianMetricSystem</cite> for more general details about
Riemannian-metric Hamiltonian systems.</p>
<p class="rubric">References</p>
<ol class="arabic simple">
<li><p>Betancourt, M., 2013. A general metric for Riemannian manifold Hamiltonian
Monte Carlo. In Geometric science of information (pp. 327-334).</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
<li><p><strong>hess_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>HessianFunction</em><em>]</em>) – Function which given a position array returns the Hessian
of <cite>neg_log_dens</cite> with respect to the position array argument as a 2D
array. Optionally the function may instead return a 3-tuple of values
with the first a 2D array containting the Hessian of <cite>neg_log_dens</cite>, the
second a 1D array containing the gradient of <cite>neg_log_dens</cite> and the
third the value of <cite>neg_log_dens</cite>, all evaluated at the passed position
array. If <cite>None</cite> is passed (the default) an automatic differentiation
fallback will be used to attempt to construct a function which
calculates the Hessian (and gradient and value) of <cite>neg_log_dens</cite>
automatically.</p></li>
<li><p><strong>mtp_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>MatrixTressianProductFunction</em><em>]</em>) – <p>Function which given a position array returns another
function which takes a 2D array (matrix) as an argument and returns the
<em>matrix-Tressian-product</em> (MTP) of <cite>neg_log_dens</cite> with respect to the
position array argument. The MTP is here defined as a function of a
matrix <cite>m</cite> corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mtp</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">tress</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>tress</cite> is the ‘Tressian’ of <cite>f = neg_log_dens(q)</cite> wrt <cite>q</cite> i.e.
the 3D array of third-order partial derivatives of the scalar-valued
function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tress[i, j, k] = ∂³f / (∂q[i] ∂q[j] ∂q[k])
</pre></div>
</div>
<p>Optionally the function may instead return a 4-tuple of values with the
first a function to compute a MTP of <cite>neg_log_dens</cite>, the second a 2D
array containing the Hessian of <cite>neg_log_dens</cite>, the third a 1D array
containing the gradient of <cite>neg_log_dens</cite> and the fourth the value of
<cite>neg_log_dens</cite>, all evaluated at the passed position array. If <cite>None</cite> is
passed (the default) an automatic differentiation fallback will be used
to attempt to construct a function which calculates the MTP (and Hesisan
and gradient and value) of <cite>neg_log_dens</cite> automatically.</p>
</p></li>
<li><p><strong>softabs_coeff</strong> (<em>ScalarLike</em>) – Positive regularisation coefficient for smooth approximation
to absolute value used to regularize Hessian eigenvalues in metric
matrix representation. As the value tends to infinity the approximation
becomes increasingly close to the absolute function.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.dh2_dmom">
<span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.dh2_dpos">
<span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.h2">
<span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.hess_neg_log_dens">
<span class="sig-name descname"><span class="pre">hess_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#SoftAbsRiemannianMetricSystem.hess_neg_log_dens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.hess_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Hessian of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>2D array of <cite>neg_log_dens(state)</cite> second derivatives with respect to
<cite>state.pos</cite>, with <cite>hessian[i, j]</cite> the second derivative of
<cite>neg_log_dens(state)</cite> with respect to <cite>state.pos[i]</cite> and <cite>state.pos[j]</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.metric" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the metric matrix representation.</p>
<p>The returned type of this function is that specified by the
<cite>metric_matrix_class</cite> argument to the initializer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Metric matrix representation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mici.matrices.html#mici.matrices.PositiveDefiniteMatrix" title="mici.matrices.PositiveDefiniteMatrix"><em>PositiveDefiniteMatrix</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.metric_func">
<span class="sig-name descname"><span class="pre">metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#SoftAbsRiemannianMetricSystem.metric_func"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function computing the parameter of the metric matrix representation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>metric_func(state.pos)</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.mtp_neg_log_dens">
<span class="sig-name descname"><span class="pre">mtp_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#SoftAbsRiemannianMetricSystem.mtp_neg_log_dens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.mtp_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Generate MTP of negative log density with respect to position.</p>
<p>The matrix-Tressian-product (MTP) is here defined as a function of a matrix <cite>m</cite>
corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mtp</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">tress</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>tress</cite> is the ‘Tressian’ of <cite>f = neg_log_dens(q)</cite> with respect to <cite>q =
state.pos</cite> i.e. the 3D array of third-order partial derivatives of the
scalar-valued function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tress[i, j, k] = ∂³f / (∂q[i] ∂q[j] ∂q[k])
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Function which accepts a 2D array of shape
<cite>(state.pos.shape[0], state.pos.shape[0])</cite> as an argument and returns an
array of shape <cite>state.pos.shape</cite> containing the computed MTP value.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>MatrixTressianProduct</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.sample_momentum">
<span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.SoftAbsRiemannianMetricSystem.vjp_metric_func">
<span class="sig-name descname"><span class="pre">vjp_metric_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#SoftAbsRiemannianMetricSystem.vjp_metric_func"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.SoftAbsRiemannianMetricSystem.vjp_metric_func" title="Permalink to this definition"></a></dt>
<dd><p>Function constructing a vector-Jacobian-product for <cite>metric_func</cite>.</p>
<p>The vector-Jacobian-product is here defined as a function of an array <cite>v</cite> (of
the same shape as the output of <cite>metric_func</cite>) corresponding to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vjp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">jacob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>jacob</cite> is the Jacobian of <cite>m = metric_func(q)</cite> wrt <cite>q</cite> i.e. the array of
partial derivatives of the function such that</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>jacob[..., i] = ∂m[...] / ∂q[i]
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute VJP at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Vector-Jacobian-product function.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>MatrixTressianProduct</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mici.systems.System">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mici.systems.</span></span><span class="sig-name descname"><span class="pre">System</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neg_log_dens</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_neg_log_dens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABC" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></a></p>
<p>Base class for Hamiltonian systems.</p>
<p>The Hamiltonian function <span class="math notranslate nohighlight">\(h\)</span> is assumed to have the general form</p>
<div class="math notranslate nohighlight">
\[h(q, p) = h_1(q) + h_2(q, p)\]</div>
<p>where <span class="math notranslate nohighlight">\(q\)</span> and <span class="math notranslate nohighlight">\(p\)</span> are the position and momentum variables respectively,
and <span class="math notranslate nohighlight">\(h_1\)</span> and <span class="math notranslate nohighlight">\(h_2\)</span> Hamiltonian component functions. The exact
Hamiltonian flow for the <span class="math notranslate nohighlight">\(h_1\)</span> component can be always be computed as it
depends only on the position variable however depending on the form of <span class="math notranslate nohighlight">\(h_2\)</span>
the corresponding exact Hamiltonian flow may or may not be simulable.</p>
<p>By default <span class="math notranslate nohighlight">\(h_1\)</span> is assumed to correspond to the negative logarithm of an
unnormalized density on the position variables with respect to the Lebesgue measure,
with the corresponding distribution on the position space being the target
distribution it is wished to draw approximate samples from.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neg_log_dens</strong> (<em>ScalarFunction</em>) – Function which given a position array returns the negative
logarithm of an unnormalized probability density on the position space
with respect to the Lebesgue measure, with the corresponding
distribution on the position space being the target distribution it is
wished to draw approximate samples from.</p></li>
<li><p><strong>grad_neg_log_dens</strong> (<em>Optional</em><em>[</em><em>GradientFunction</em><em>]</em>) – Function which given a position array returns the
derivative of <cite>neg_log_dens</cite> with respect to the position array
argument. Optionally the function may instead return a 2-tuple of values
with the first being the array corresponding to the derivative and the
second being the value of the <cite>neg_log_dens</cite> evaluated at the passed
position array. If <cite>None</cite> is passed (the default) an automatic
differentiation fallback will be used to attempt to construct the
derivative of <cite>neg_log_dens</cite> automatically.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.dh1_dpos">
<span class="sig-name descname"><span class="pre">dh1_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.dh1_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.dh1_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h1</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed <cite>h1</cite> derivative.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.dh2_dmom">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dh2_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.dh2_dmom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.dh2_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.dh2_dpos">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dh2_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.dh2_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.dh2_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of <cite>h2</cite> Hamiltonian component with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.dh_dmom">
<span class="sig-name descname"><span class="pre">dh_dmom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.dh_dmom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.dh_dmom" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to momentum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.mom</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.dh_dpos">
<span class="sig-name descname"><span class="pre">dh_dpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.dh_dpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.dh_dpos" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of Hamiltonian with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.grad_neg_log_dens">
<span class="sig-name descname"><span class="pre">grad_neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.grad_neg_log_dens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.grad_neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Derivative of negative log density with respect to position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>neg_log_dens(state)</cite> derivative with respect to <cite>state.pos</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.h">
<span class="sig-name descname"><span class="pre">h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.h"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.h" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian function for system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.h1">
<span class="sig-name descname"><span class="pre">h1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.h1"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.h1" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending only on position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h1</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.h1_flow">
<span class="sig-name descname"><span class="pre">h1_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.h1_flow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.h1_flow" title="Permalink to this definition"></a></dt>
<dd><p>Apply exact flow map corresponding to <cite>h1</cite> Hamiltonian component.</p>
<p><cite>state</cite> argument is modified in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to start flow at.</p></li>
<li><p><strong>dt</strong> (<em>ScalarLike</em>) – Time interval to simulate flow for.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.h2">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">h2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.h2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.h2" title="Permalink to this definition"></a></dt>
<dd><p>Hamiltonian component depending on momentum and optionally position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of <cite>h2</cite> Hamiltonian component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.neg_log_dens">
<span class="sig-name descname"><span class="pre">neg_log_dens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.neg_log_dens"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.neg_log_dens" title="Permalink to this definition"></a></dt>
<dd><p>Negative logarithm of unnormalized density of target distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State to compute value at.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Value of computed negative log density.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ScalarLike</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mici.systems.System.sample_momentum">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">sample_momentum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mici/systems.html#System.sample_momentum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mici.systems.System.sample_momentum" title="Permalink to this definition"></a></dt>
<dd><p>Sample a momentum from its conditional distribution given a position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<a class="reference internal" href="mici.states.html#mici.states.ChainState" title="mici.states.ChainState"><em>ChainState</em></a>) – State defining position to condition on.</p></li>
<li><p><strong>rng</strong> (<em>Generator</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sampled momentum.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ArrayLike</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mici.states.html" class="btn btn-neutral float-left" title="mici.states module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mici.transitions.html" class="btn btn-neutral float-right" title="mici.transitions module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Matt Graham.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>